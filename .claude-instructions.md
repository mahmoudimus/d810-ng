# Claude Code Instructions for D810-NG

## Repository Organization Guidelines

### File Organization Rules

**DO:**
- ✅ Place all documentation in `docs/`
- ✅ Place all utility scripts in `scripts/`
- ✅ Place session summaries and analysis in `docs/archive/`
- ✅ Keep the root directory clean and professional

**DON'T:**
- ❌ Create markdown files in the root directory (except README.md, AUTHORS.md, REFACTORING.md)
- ❌ Create Python/shell scripts in the root directory
- ❌ Create session-specific documents in the root
- ❌ Leave temporary files or analysis documents in the root

### Directory Structure

```
d810-ng/
├── README.md                   # Main user documentation (KEEP)
├── AUTHORS.md                  # Contributors (KEEP)
├── REFACTORING.md              # Architecture refactoring plan (KEEP)
├── docs/                       # ALL documentation goes here
│   ├── README.md              # Documentation index
│   ├── DSL_MIGRATION.md       # Complete DSL guide
│   ├── TESTING_INSTRUMENTATION.md
│   └── archive/               # Historical documents
│       ├── MIGRATION_GUIDE.md
│       ├── RETROSPECTIVE.md
│       ├── CONSTRAINT_DSL_DESIGN.md
│       └── MIGRATION_COMPLETE.md
├── scripts/                    # ALL scripts go here
│   ├── README.md
│   ├── migration/             # Migration-related scripts
│   │   ├── bulk_migrate_cst.py
│   │   ├── constraint_dsl_implementation.py
│   │   └── ...
│   ├── run_integration_tests.sh
│   └── test_with_docker.sh
├── src/                        # Source code
├── tests/                      # Tests
└── samples/                    # Sample binaries

```

### When Creating New Documents

**For permanent documentation:**
- Create in `docs/` with a descriptive name
- Add an entry to `docs/README.md`
- Use clear section headers and table of contents

**For session summaries:**
- Create in `docs/archive/` with date prefix if needed
- Keep it concise - link to main docs for details

**For analysis or debugging:**
- Create in `docs/archive/` with clear prefix (e.g., `DEBUG_`, `ANALYSIS_`)
- Delete or move to archive when no longer needed

### When Creating Scripts

**For development tools:**
- Place in `scripts/` with clear name
- Add brief description in `scripts/README.md`

**For migration tools:**
- Place in `scripts/migration/`
- Add documentation comment at top of file

**For test utilities:**
- Consider if it belongs in `tests/` instead
- If general utility, place in `scripts/`

### Before Committing

Check that the root directory contains ONLY:
- README.md
- AUTHORS.md
- REFACTORING.md
- LICENSE (if exists)
- .gitignore
- pyproject.toml, setup.py (build configs)
- .github/, .claude/ (tool configs)

If you find:
- `*.md` (other than above) → Move to `docs/` or `docs/archive/`
- `*.py`, `*.sh` → Move to `scripts/`
- Session summaries, analyses → Move to `docs/archive/`

### Documentation Standards

When creating documentation:

1. **Use descriptive titles** - Clear, specific names
2. **Include table of contents** - For documents >100 lines
3. **Add references** - Link to related docs
4. **Keep it current** - Update when code changes
5. **Examples** - Include code examples where helpful

### Migration Context

The d810-ng pattern matching rules have been fully migrated to a declarative DSL:
- ✅ 172 rules (170 correct + 2 known_incorrect)
- ✅ 100% Z3 verification
- ✅ No more `_refactored` suffixes
- ✅ All rules in `src/d810/optimizers/microcode/instructions/pattern_matching/rewrite_*.py`

**Key Files:**
- `src/d810/optimizers/dsl.py` - DSL implementation
- `src/d810/optimizers/rules.py` - VerifiableRule base class
- `tests/unit/optimizers/test_verifiable_rules.py` - Automated tests

**Main Documentation:**
- `docs/DSL_MIGRATION.md` - Complete guide to the DSL system
- `README.md` - User-facing quick start

### Quick Reference

**Adding a new rule:**
```python
# In src/d810/optimizers/microcode/instructions/pattern_matching/rewrite_*.py
from d810.optimizers.dsl import Var, Const
from d810.optimizers.rules import VerifiableRule

x, y = Var("x_0"), Var("x_1")

class MyRule(VerifiableRule):
    PATTERN = (x | y) - (x & y)
    REPLACEMENT = x ^ y
    DESCRIPTION = "Simplify to XOR"
```

**Testing:**
```bash
pytest tests/unit/optimizers/test_verifiable_rules.py -k "MyRule" -v
```

**Documentation location:**
- Main guide: `docs/DSL_MIGRATION.md`
- Quick start: `README.md` (section: "Adding New Deobfuscation Rules")

---

## Summary

**Keep the root clean!** Use `docs/` for documentation and `scripts/` for scripts.

The repository should look professional and well-organized. Future contributors should easily understand the structure and find what they need.
